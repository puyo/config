#!/usr/bin/ruby
#
# Greg's gvim wrapper. Parses arguments and opens all sorts of random junk I
# paste into it. ;)

def gvim(file, line=nil)
  if line.nil?
    system('gvim', '--remote-send', ":e #{file}<CR>") || system('gvim', file)
  else
    system('gvim', '--remote-send', ":e +#{line} #{file}<CR>") || system('gvim', file, "+#{line}")
  end
end

if ARGV.empty?
  system('gvim')
else
  ARGV.each do |arg|
    file_path = line = nil
    if match = /^(.+):(\d+):?$/.match(arg) # standard error format (gcc, pylint, ruby, grep -n)
      file_path, line = match[1], match[2]
    elsif match = /^(.+?):/.match(arg) # grep without -n
      file_path = match[1]
    else
      file_path = arg
    end
    gvim(file_path, line)
  end
end
