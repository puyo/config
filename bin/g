#!/usr/bin/env ruby
#
# Greg's gvim wrapper. Parses arguments and opens all sorts of random junk I
# paste into it. ;)

vim = 'gvim'
line = nil

running = system("#{vim} --serverlist | grep -q VIM")
args =
  if ARGV.size == 1
    file, line = ARGV.first.split(':')
    file.gsub!(%r{^[ab]/}, '') # git diff
    [file]
  elsif ARGV.size > 1
    ARGV
  else
    ['.']
  end

if running
  args.each { |arg| system(vim, '--remote-silent', arg) }
else
  system(vim, *args)
end

system(vim, '--remote-send', ":#{line}<CR>") if line
