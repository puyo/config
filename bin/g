#!/usr/bin/env ruby
#
# Greg's gvim wrapper. Parses arguments and opens all sorts of random junk I
# paste into it. ;)

vim = 'gvim'
file = line = nil

running = system("#{vim} --serverlist | grep -q VIM")
if ARGV.any?
  file, line = ARGV.first.split(':')
  file.gsub!(/^[ab]\//, '') # git diff
  ARGV[0] = file
else
  ARGV[0] = '.'
  file = line = nil
end

if running
  system(vim, '--remote-silent', *ARGV)
else
  system(vim, *ARGV)
end
system(vim, '--remote-send', ":#{line}<CR>") if line
